var myMap,writeLink=document.querySelector(".button-write"),writeOverlay=document.querySelector(".modal-overlay"),writePopup=document.querySelector(".modal"),writeClose=writePopup.querySelector(".modal-close"),writeLogin=writePopup.querySelector("[name=login]"),writeEmail=writePopup.querySelector("[name=email]"),writeMessage=writePopup.querySelector("[name=message]"),isStorageSupport=!0,storage="";try{storage=localStorage.getItem("login")}catch(e){isStorageSupport=!1}var writeForm=writePopup.querySelector("form");function init(){myMap=new ymaps.Map($(".map")[0],{center:[59.939008,30.321048],zoom:17,controls:[]},{searchControlProvider:"yandex#search"}),MyIconContentLayout=ymaps.templateLayoutFactory.createClass('<div style="color: #FFFFFF; font-weight: bold;">$[properties.iconContent]</div>'),myPlacemark=new ymaps.Placemark([59.938657,30.323273],{},{iconLayout:"default#image",iconImageHref:"img/map-marker.png",iconImageSize:[231,190],iconImageOffset:[-59,-208]}),myMap.geoObjects.add(myPlacemark)}ymaps.ready(init),writeLink.addEventListener("click",function(e){e.preventDefault(),writePopup.classList.add("modal-show"),writePopup.classList.add("modal-animation"),writeOverlay.classList.add("modal-show"),storage?(writeLogin.value=storage,writeEmail.focus()):writeLogin.focus()}),writeClose.addEventListener("click",function(e){e.preventDefault(),writePopup.classList.remove("modal-show"),writePopup.classList.remove("modal-animation"),writeOverlay.classList.remove("modal-show"),writePopup.classList.remove("modal-error")}),writeOverlay.addEventListener("click",function(e){writePopup.classList.remove("modal-show"),writePopup.classList.remove("modal-animation"),writeOverlay.classList.remove("modal-show"),writePopup.classList.remove("modal-error")}),writeForm.addEventListener("submit",function(e){writeLogin.value&&writeEmail.value&&writeMessage.value?isStorageSupport&&localStorage.setItem("login",writeLogin.value):(e.preventDefault(),writePopup.classList.remove("modal-error"),writePopup.offsetWidth=writePopup.offsetWidth,writePopup.classList.add("modal-error"))}),window.addEventListener("keydown",function(e){27===e.keyCode&&(e.preventDefault(),writePopup.classList.contains("modal-show")&&(writePopup.classList.remove("modal-show"),writePopup.classList.remove("modal-animation"),writeOverlay.classList.remove("modal-show"),writePopup.classList.remove("modal-error")))});